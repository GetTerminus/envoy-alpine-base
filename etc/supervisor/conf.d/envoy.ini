[program:envoy_config]
command=/usr/local/bin/configure.py /etc/envoy/
startsecs=0
priority=900
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[program:envoy]
command=/usr/local/bin/envoy -c /etc/envoy/envoy.yaml --v2-config-only --service-cluster c0 --service-node n0 --log-level warn
autostart=false
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0

[eventlistener:envoy_exit]
command=/usr/local/bin/kill_supervisor.py
process_name=envoy
events=PROCESS_STATE_FATAL

[eventlistener:envoy_configured]
command=supervisorctl start envoy
process_name=envoy_config
events=PROCESS_STATE_EXITED
